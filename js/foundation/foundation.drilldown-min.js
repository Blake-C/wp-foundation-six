!function($,n){"use strict";function i(e,t){this.$element=e,this.options=$.extend({},i.defaults,this.$element.data(),t),n.Nest.Feather(this.$element,"drilldown"),this._init(),n.registerPlugin(this),n.Keyboard.register("Drilldown",{ENTER:"open",SPACE:"open",ARROW_RIGHT:"next",ARROW_UP:"up",ARROW_DOWN:"down",ARROW_LEFT:"previous",ESCAPE:"close",TAB:"down",SHIFT_TAB:"up"})}i.defaults={backButton:'<li class="js-drilldown-back" tabindex="0"><a>Back</a></li>',wrapper:"<div></div>",closeOnClick:!1},i.prototype._init=function(){this.$submenuAnchors=this.$element.find("li.has-submenu"),this.$submenus=this.$submenuAnchors.children("[data-submenu]").addClass("is-drilldown-sub"),this.$menuItems=this.$element.find("li").not(".js-drilldown-back").attr("role","menuitem"),this._prepareMenu(),this._keyboardEvents()},i.prototype._prepareMenu=function(){var n=this;this.$submenuAnchors.each(function(){var i=$(this);i.find("a")[0].removeAttribute("href"),i.children("[data-submenu]").attr({"aria-hidden":!0,tabindex:0,role:"menu"}),n._events(i)}),this.$submenus.each(function(){var i=$(this),e=i.find(".js-drilldown-back");e.length||(i.prepend(n.options.backButton),n._back(i))}),this.$element.parent().hasClass("is-drilldown")||(this.$wrapper=$(this.options.wrapper).addClass("is-drilldown").css(this._getMaxDims()),this.$element.wrap(this.$wrapper))},i.prototype._events=function(n){var i=this;n.off("click.zf.drilldown").on("click.zf.drilldown",function(e){if(e.stopImmediatePropagation(),e.preventDefault(),e.target!==e.currentTarget.firstElementChild)return!1;if(i._show(n),i.options.closeOnClick){var t=$("body").not(i.$wrapper);t.off(".zf.drilldown").on("click.zf.drilldown",function(n){n.preventDefault(),i._hideAll(),t.off(".zf.drilldown")})}})},i.prototype._keyboardEvents=function(){var i=this;this.$menuItems.add(this.$element.find(".js-drilldown-back")).on("keydown.zf.drilldown",function(e){var t=$(this),o=t.parent("ul").children("li"),s,l;o.each(function(n){return $(this).is(t)?(s=o.eq(Math.max(0,n-1)),void(l=o.eq(Math.min(n+1,o.length-1)))):void 0}),n.Keyboard.handleKey(e,i,{next:function(){t.is(i.$submenuAnchors)&&(i._show(t),t.on(n.transitionend(t),function(){t.find("ul li").filter(i.$menuItems).first().focus()}))},previous:function(){i._hide(t.parent("ul")),t.parent("ul").on(n.transitionend(t),function(){setTimeout(function(){t.parent("ul").parent("li").focus()},1)})},up:function(){s.focus()},down:function(){l.focus()},close:function(){i._back()},open:function(){t.is(i.$menuItems)?t.is(i.$submenuAnchors)&&(i._show(t),setTimeout(function(){t.find("ul li").filter(i.$menuItems).first().focus()},1)):(i._hide(t.parent("ul")),setTimeout(function(){t.parent("ul").parent("li").focus()},1))},handled:function(){e.preventDefault(),e.stopImmediatePropagation()}})})},i.prototype._hideAll=function(){var i=this.$element.find(".is-drilldown-sub.is-active").addClass("is-closing");i.one(n.transitionend(i),function(n){i.removeClass("is-active is-closing")}),this.$element.trigger("closed.zf.drilldown")},i.prototype._back=function(n){var i=this;n.off("click.zf.drilldown"),n.children(".js-drilldown-back").on("click.zf.drilldown",function(e){e.stopImmediatePropagation(),i._hide(n)})},i.prototype._menuLinkEvents=function(){var n=this;this.$menuItems.not(".has-submenu").off("click.zf.drilldown").on("click.zf.drilldown",function(i){setTimeout(function(){n._hideAll()},0)})},i.prototype._show=function(n){n.children("[data-submenu]").addClass("is-active"),this.$element.trigger("open.zf.drilldown",[n])},i.prototype._hide=function(i){var e=this;i.addClass("is-closing").one(n.transitionend(i),function(){i.removeClass("is-active is-closing")}),i.trigger("hide.zf.drilldown",[i])},i.prototype._getMaxDims=function(){var n=0,i={};return this.$submenus.add(this.$element).each(function(){var i=$(this).children("li").length;n=i>n?i:n}),i.height=n*this.$menuItems[0].getBoundingClientRect().height+"px",i.width=this.$element[0].getBoundingClientRect().width+"px",i},i.prototype.destroy=function(){this._hideAll(),n.Nest.Burn(this.$element,"drilldown"),this.$element.unwrap().find(".js-drilldown-back").remove().end().find(".is-active, .is-closing, .is-drilldown-sub").removeClass("is-active is-closing is-drilldown-sub").end().find("[data-submenu]").removeAttr("aria-hidden tabindex role").off(".zf.drilldown").end().off("zf.drilldown"),n.unregisterPlugin(this)},n.plugin(i,"Drilldown")}(jQuery,window.Foundation);