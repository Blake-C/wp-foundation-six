!function($,n){"use strict";function e(i,t){this.$element=i,this.options=$.extend({},e.defaults,this.$element.data(),t),n.Nest.Feather(this.$element,"drilldown"),this._init(),n.registerPlugin(this,"Drilldown"),n.Keyboard.register("Drilldown",{ENTER:"open",SPACE:"open",ARROW_RIGHT:"next",ARROW_UP:"up",ARROW_DOWN:"down",ARROW_LEFT:"previous",ESCAPE:"close",TAB:"down",SHIFT_TAB:"up"})}e.defaults={backButton:'<li class="js-drilldown-back"><a>Back</a></li>',wrapper:"<div></div>",closeOnClick:!1},e.prototype._init=function(){this.$submenuAnchors=this.$element.find("li.has-submenu"),this.$submenus=this.$submenuAnchors.children("[data-submenu]"),this.$menuItems=this.$element.find("li").not(".js-drilldown-back").attr("role","menuitem"),this._prepareMenu(),this._keyboardEvents()},e.prototype._prepareMenu=function(){var n=this;this.$submenuAnchors.each(function(){var e=$(this),i=e.find("a:first");i.data("savedHref",i.attr("href")).removeAttr("href"),e.children("[data-submenu]").attr({"aria-hidden":!0,tabindex:0,role:"menu"}),n._events(e)}),this.$submenus.each(function(){var e=$(this),i=e.find(".js-drilldown-back");i.length||e.prepend(n.options.backButton),n._back(e)}),this.$element.parent().hasClass("is-drilldown")||(this.$wrapper=$(this.options.wrapper).addClass("is-drilldown").css(this._getMaxDims()),this.$element.wrap(this.$wrapper))},e.prototype._events=function(n){var e=this;n.off("click.zf.drilldown").on("click.zf.drilldown",function(i){if($(i.target).parentsUntil("ul","li").hasClass("is-drilldown-submenu-parent")&&(i.stopImmediatePropagation(),i.preventDefault()),e._show(n),e.options.closeOnClick){var t=$("body").not(e.$wrapper);t.off(".zf.drilldown").on("click.zf.drilldown",function(n){n.preventDefault(),e._hideAll(),t.off(".zf.drilldown")})}})},e.prototype._keyboardEvents=function(){var e=this;this.$menuItems.add(this.$element.find(".js-drilldown-back")).on("keydown.zf.drilldown",function(i){var t=$(this),s=t.parent("ul").children("li"),o,l;s.each(function(n){return $(this).is(t)?(o=s.eq(Math.max(0,n-1)),void(l=s.eq(Math.min(n+1,s.length-1)))):void 0}),n.Keyboard.handleKey(i,"Drilldown",{next:function(){t.is(e.$submenuAnchors)&&(e._show(t),t.on(n.transitionend(t),function(){t.find("ul li").filter(e.$menuItems).first().focus()}))},previous:function(){e._hide(t.parent("ul")),t.parent("ul").on(n.transitionend(t),function(){setTimeout(function(){t.parent("ul").parent("li").focus()},1)})},up:function(){o.focus()},down:function(){l.focus()},close:function(){e._back()},open:function(){t.is(e.$menuItems)?t.is(e.$submenuAnchors)&&(e._show(t),setTimeout(function(){t.find("ul li").filter(e.$menuItems).first().focus()},1)):(e._hide(t.parent("ul")),setTimeout(function(){t.parent("ul").parent("li").focus()},1))},handled:function(){i.preventDefault(),i.stopImmediatePropagation()}})})},e.prototype._hideAll=function(){var e=this.$element.find(".is-drilldown-sub.is-active").addClass("is-closing");e.one(n.transitionend(e),function(n){e.removeClass("is-active is-closing")}),this.$element.trigger("closed.zf.drilldown")},e.prototype._back=function(n){var e=this;n.off("click.zf.drilldown"),n.children(".js-drilldown-back").on("click.zf.drilldown",function(i){i.stopImmediatePropagation(),e._hide(n)})},e.prototype._menuLinkEvents=function(){var n=this;this.$menuItems.not(".has-submenu").off("click.zf.drilldown").on("click.zf.drilldown",function(e){setTimeout(function(){n._hideAll()},0)})},e.prototype._show=function(n){n.children("[data-submenu]").addClass("is-active"),this.$element.trigger("open.zf.drilldown",[n])},e.prototype._hide=function(e){var i=this;e.addClass("is-closing").one(n.transitionend(e),function(){e.removeClass("is-active is-closing")}),e.trigger("hide.zf.drilldown",[e])},e.prototype._getMaxDims=function(){var n=0,e={};return this.$submenus.add(this.$element).each(function(){var e=$(this).children("li").length;n=e>n?e:n}),e.height=n*this.$menuItems[0].getBoundingClientRect().height+"px",e.width=this.$element[0].getBoundingClientRect().width+"px",e},e.prototype.destroy=function(){this._hideAll(),n.Nest.Burn(this.$element,"drilldown"),this.$element.unwrap().find(".js-drilldown-back").remove().end().find(".is-active, .is-closing, .is-drilldown-sub").removeClass("is-active is-closing is-drilldown-sub").end().find("[data-submenu]").removeAttr("aria-hidden tabindex role").off(".zf.drilldown").end().off("zf.drilldown"),this.$element.find("a").each(function(){var n=$(this);n.data("savedHref")&&n.attr("href",n.data("savedHref")).removeData("savedHref")}),n.unregisterPlugin(this)},n.plugin(e,"Drilldown")}(jQuery,window.Foundation);