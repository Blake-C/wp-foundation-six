!function(e,$){"use strict";function t(i,n){this.$element=i,this.options=$.extend({},t.defaults,this.$element.data(),n),e.Nest.Feather(this.$element,"dropdown"),this._init(),e.registerPlugin(this),e.Keyboard.register("DropdownMenu",{ENTER:"open",SPACE:"open",ARROW_RIGHT:"next",ARROW_UP:"up",ARROW_DOWN:"down",ARROW_LEFT:"previous",ESCAPE:"close"})}t.defaults={clickOpen:!0,closeOnClick:!1,disableHover:!1,autoclose:!0,hoverDelay:150,closingTime:500,alignment:"left",verticalClass:"vertical",rightClass:"align-right"},t.prototype._init=function(){this.$element.hasClass(this.options.verticalClass)&&(this.vertical=!0),this._prepareMenu()},t.prototype._prepareMenu=function(){var e=this;this.$tabs=this.$element.children("li.has-submenu"),this.$tabs.children("[data-submenu]").addClass("first-sub"),this.$submenus=this.$element.find("li.has-submenu"),this.$menuItems=this.$element.find("li").attr({role:"menuitem",tabindex:0}),this.$menuItems.children("a").attr("tabindex",-1),this.$element.hasClass(this.options.rightClass)?(this.options.alignment="right",this.$submenus.addClass("is-left-arrow opens-left")):this.$submenus.addClass("is-right-arrow opens-right"),this.vertical||this.$tabs.removeClass("is-right-arrow is-left-arrow opens-left opens-right").addClass("is-down-arrow"),this.$tabs.each(function(){var e=$(this);e.attr({role:"menuitem",tabindex:0,"aria-label":e.children("a:first-child").text()}).children("a").attr("tabindex",-1),e.children("[data-submenu]")&&e.attr("aria-haspopup",!0)}),this.$submenus.each(function(){var t=$(this);t.children("[data-submenu]").attr({"aria-hidden":!0,tabindex:-1,role:"menu"}).addClass("vertical"),e._events(t)})},t.prototype._events=function(t){var i=this,n=void 0!==window.ontouchstart;(this.options.clickOpen||n)&&t.off("click.zf.dropdownmenu").on("click.zf.dropdownmenu",function(e){if($(this).hasClass("is-dropdown-submenu-parent")){var s=t.data("isClick");n&&s||(e.preventDefault(),e.stopPropagation(),s?i._hide(t):(i._hideOthers(t),i._show(t),t.data("isClick",!0).parentsUntil("[data-dropdown-menu]",".is-dropdown-submenu-parent").data("isClick",!0),i.options.closeOnClick&&i._addBodyHandler()))}}),this.options.disableHover||(this.$menuItems.on("mouseenter.zf.dropdownmenu",function(e){var t=$(this);t.hasClass("is-active")||i._hideOthers(t)}),t.off("mouseenter.zf.dropdownmenu").on("mouseenter.zf.dropdownmenu",function(e){clearTimeout(t.closeTimer),t.hasClass("is-active")||(t.openTimer=setTimeout(function(){i._show(t)},i.options.hoverDelay))}).on("mouseleave.zf.dropdownmenu",function(e){!t.data("isClick")&&i.options.autoclose&&(clearTimeout(t.openTimer),t.closeTimer=setTimeout(function(){i._hide(t)},i.options.closingTime))})),this.$menuItems.on("keydown.zf.dropdownmenu",function(t){var n=$(this),s=i.$element.children("li"),o=n.is(s),a=o?s:n.parents("li").first().add(n.parent("ul").children("li")),r,d;a.each(function(e){return $(this).is(n)?(r=a.eq(e-1),void(d=a.eq(e+1))):void 0});var l=function(){n.is(":last-child")||d.focus()},h=function(){r.focus()},u=function(){n.has("ul").length&&(i._show(n),n.find("li").first().focus())},p=function(){n.parents("li").first().focus(),i._hide(n.parents("li").first())},c={open:u,close:function(){i._hideAll(),i.$menuItems.first().focus()},handled:function(){t.preventDefault(),t.stopImmediatePropagation()}};o?i.vertical?"left"===i.options.alignment?$.extend(c,{down:l,up:h,next:u,previous:p}):$.extend(c,{down:l,up:h,next:p,previous:u}):$.extend(c,{next:l,previous:h,down:u,up:p}):"left"===i.options.alignment?$.extend(c,{next:u,previous:p,down:l,up:h}):$.extend(c,{next:p,previous:u,down:l,up:h}),e.Keyboard.handleKey(t,i,c)})},t.prototype._toggle=function(e){e.hasClass("is-active")?this._hide(e):this._show(e)},t.prototype._addBodyHandler=function(){var e=$("body"),t=this;e.not(t.$element).on("click.zf.dropdownmenu tap.zf.dropdownmenu touchend.zf.dropdownmenu",function(i){t._hideAll(),e.off("click.zf.dropdownmenu tap.zf.dropdownmenu touchend.zf.dropdownmenu")})},t.prototype._show=function(t){this._hideOthers(t),t.focus();var i=t.children("[data-submenu]:first-of-type");t.addClass("is-active"),i.css("visibility","hidden").addClass("js-dropdown-active").attr("aria-hidden",!1);var n=e.Box.ImNotTouchingYou(i,null,!0);n||("left"===this.options.alignment?t.removeClass("opens-left").addClass("opens-right"):t.removeClass("opens-right").addClass("opens-left"),this.changed=!0,n=e.Box.ImNotTouchingYou(i,null,!0),n||(t.removeClass("opens-left opens-right").addClass("opens-inner"),this.changed=!0)),i.css("visibility",""),this.$element.trigger("show.zf.dropdownmenu",[t])},t.prototype._hide=function(e){this._hideSome(e)},t.prototype._hideSome=function(e){e.length&&(e.removeClass("is-active opens-inner").data("isClick",!1).find(".is-active").removeClass("is-active").data("isClick",!1).end().find(".js-dropdown-active").removeClass("js-dropdown-active").attr("aria-hidden",!0),e.parent(".has-submenu").removeClass("is-active"),this.changed&&("left"===this.options.alignment?e.find(".opens-left").removeClass("opens-left").addClass("opens-right"):e.find(".opens-right").removeClass("opens-right").addClass("opens-left")),this.$element.trigger("hide.zf.dropdownmenu"))},t.prototype._hideOthers=function(e){this._hideSome(e.siblings(".has-submenu.is-active"))},t.prototype._hideAll=function(){this._hideSome(this.$element)},t.prototype.destroy=function(){this._hideAll(),this.$element.removeData("zf-plugin").find("li").removeClass("js-dropdown-nohover is-right-arrow is-left-arrow opens-left opens-inner opens-right").add("a").off(".zf.dropdownmenu").end().find("ul").removeClass("first-sub"),e.Nest.Burn(this.$element,"dropdown"),e.unregisterPlugin(this)},e.plugin(t,"DropdownMenu");var i=function(e){return e.hasClass("is-active")}}(Foundation,jQuery);